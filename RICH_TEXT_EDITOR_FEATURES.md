# 富文本编辑器功能升级说明

## 🎉 新增功能

### 1. 图片功能 📷

#### 三种插入方式

1. **点击按钮上传**
   - 点击工具栏的图片图标
   - 选择本地图片文件（支持 jpg、png、gif 等）
   - 自动插入到编辑器

2. **复制粘贴**
   - 复制任何图片（从网页、截图工具等）
   - 在编辑器中按 `Ctrl/Cmd + V` 粘贴
   - 图片自动显示

3. **拖拽上传**
   - 从文件管理器拖拽图片到编辑器
   - 松开鼠标即可插入
   - 支持一次拖拽多张图片

#### 图片限制

- 单张图片不超过 5MB
- 自动转换为 Base64 格式
- 响应式显示，自动适应容器宽度

### 2. 任务列表 ✅

创建待办事项列表，支持勾选/取消勾选：

```
☐ 未完成的任务
☑ 已完成的任务
```

使用场景：
- 需求检查清单
- 开发任务分解
- 测试用例列表

### 3. 引用块 💬

插入引用内容，适合：
- 引用产品需求
- 引用用户反馈
- 引用设计稿说明

显示效果：带有左边框的斜体文本，视觉上突出显示。

### 4. 行内代码 💻

使用 \`代码\` 包裹，适合标记：
- 变量名
- API 端点
- 配置项

### 5. 表格 📊

#### 功能特性

- 点击按钮插入表格（默认 3行×3列）
- 自动生成表头
- 支持调整列宽
- 可添加/删除行列

#### 使用场景

- 功能对比表
- 技术方案对比
- 测试数据展示
- 进度跟踪

### 6. 紧凑模式（评论专用）

评论区使用紧凑工具栏：
- 隐藏标题功能（H1、H2、H3）
- 隐藏对齐功能
- 保留核心编辑功能
- 最小高度 100px

## 📍 应用场景

### 需求创建/编辑页

**工具栏**：完整功能
- ↩️ 撤销/重做
- 🔤 标题（H1、H2、H3）
- **B** 粗体、*I* 斜体、~~删除线~~、`代码`
- 📋 列表（无序、有序、任务）
- ⬅️ 对齐（左、中、右）
- 🔗 链接、📷 图片
- 💬 引用、📊 表格

### 需求详情页

**模式**：只读
- 无工具栏
- 完整渲染所有格式
- 保留交互（点击链接、勾选任务等）

### 评论区

**模式**：紧凑
- 精简工具栏
- 支持核心格式化
- 支持图片和链接
- 快速输入体验

## 🎨 界面优化

### 工具栏

- 图标化设计，直观易用
- 按钮分组（撤销、标题、格式、列表、对齐、插入）
- 激活状态高亮显示
- 悬停提示（Tooltip）

### 编辑区

- 最小高度
  - 完整模式：200px
  - 紧凑模式：100px
  - 只读模式：自适应
- 占位符文本
- 聚焦边框高亮

### 样式

- 明暗主题自动切换
- 表格边框和表头样式
- 引用块左边框
- 任务列表复选框

## 🔧 技术实现

### 新增依赖

```bash
@tiptap/extension-image
@tiptap/extension-task-list
@tiptap/extension-task-item
@tiptap/extension-blockquote
@tiptap/extension-table
@tiptap/extension-table-row
@tiptap/extension-table-header
@tiptap/extension-table-cell
```

### 核心功能

1. **图片处理**
   - 监听粘贴事件（handlePaste）
   - 监听拖拽事件（handleDrop）
   - 文件大小验证
   - Base64 编码

2. **表格管理**
   - 可调整列宽
   - 单元格选择
   - 表头样式区分

## 📱 响应式支持

- 工具栏自动换行
- 图片自适应宽度
- 表格横向滚动
- 移动端触摸友好

## 🔒 安全性

### XSS 防护

- 过滤危险脚本标签
- 验证图片文件类型
- 验证文件大小
- 安全的 HTML 渲染

### 内容验证

- 纯文本长度检查
- 危险协议检测（javascript:、data: 等）
- 文件类型白名单

## 💡 使用技巧

### 1. 快速插入图片

最快的方式：
1. 截图（Windows: Win+Shift+S，macOS: Cmd+Shift+4）
2. 直接在编辑器中粘贴
3. 图片立即显示

### 2. 任务列表管理

- 点击复选框切换状态
- 嵌套任务列表（Tab 缩进）
- 适合分解复杂需求

### 3. 表格技巧

- 拖拽列边界调整宽度
- 表头用于列名
- 适合对比展示

## 🐛 已知限制

### 图片

- ⚠️ 使用 Base64 存储，不适合大图片
- 💡 建议：小于 5MB 的图片
- 🔮 未来：集成 CDN 上传

### 代码块

- ❌ 暂不支持代码块功能（因兼容性问题已移除）
- ✅ 可使用行内代码 \`code\`
- 🔮 未来：重新集成代码块

### 视频

- ❌ 暂不支持视频上传
- 💡 可以使用视频链接
- 🔮 未来：支持视频嵌入

### 协同编辑

- ❌ 暂不支持多人实时编辑
- 🔮 未来：集成 Y.js 协同编辑

## 📊 对比表格

| 功能 | 之前 | 现在 |
|-----|------|------|
| 需求描述 | 纯文本 | 富文本 + 图片 + 表格 |
| 评论输入 | 纯文本 | 富文本 + 图片 + 任务列表 |
| 格式支持 | 无 | 标题、列表、引用、表格 |
| 图片插入 | 需要附件 | 直接粘贴/拖拽 |
| 代码分享 | 纯文本 | 行内代码 |
| 待办事项 | 文字描述 | 可勾选的任务列表 |

## 🎯 推荐用法

### 需求文档

```
# 需求标题

## 背景
> 引用产品经理的原话或用户反馈

## 功能点
- [ ] 功能点 1
- [ ] 功能点 2
- [x] 已完成的功能

## 技术实现
使用 `React` 框架开发，调用 `/api/submit` 接口

## 对比方案
| 方案 | 优点 | 缺点 |
|-----|------|------|
| A | 简单 | 功能少 |
| B | 完整 | 复杂 |
```

### 评论示例

```
这个需求很棒！👍

我的建议：
- [ ] 增加错误提示
- [ ] 优化加载速度

参考设计：
[图片：拖拽插入设计稿截图]
```

## 📚 更多文档

详细文档请查看：`docs/RICH_TEXT_EDITOR.md`
