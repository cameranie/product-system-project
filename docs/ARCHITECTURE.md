# é¡¹ç›®æ¶æ„æ–‡æ¡£

> æœ¬æ–‡æ¡£æè¿°éœ€æ±‚ç®¡ç†ç³»ç»Ÿçš„æ•´ä½“æ¶æ„è®¾è®¡ã€æ ¸å¿ƒæ¨¡å—å’ŒæŠ€æœ¯æ ˆ

æœ€åæ›´æ–°ï¼š2025-09-30

---

## ğŸ“‹ ç›®å½•

- [æŠ€æœ¯æ ˆ](#æŠ€æœ¯æ ˆ)
- [é¡¹ç›®ç»“æ„](#é¡¹ç›®ç»“æ„)
- [æ ¸å¿ƒæ¨¡å—](#æ ¸å¿ƒæ¨¡å—)
- [æ•°æ®æµ](#æ•°æ®æµ)
- [å®‰å…¨æ¶æ„](#å®‰å…¨æ¶æ„)
- [æ€§èƒ½ä¼˜åŒ–](#æ€§èƒ½ä¼˜åŒ–)
- [é…ç½®ç®¡ç†](#é…ç½®ç®¡ç†)

---

## ğŸ› ï¸ æŠ€æœ¯æ ˆ

### å‰ç«¯æ¡†æ¶
- **Next.js 14** - Reactæ¡†æ¶ï¼ˆApp Routerï¼‰
- **TypeScript** - ç±»å‹å®‰å…¨
- **React 18** - UIåº“

### UIç»„ä»¶
- **shadcn/ui** - ç»„ä»¶åº“
- **Tailwind CSS** - æ ·å¼æ¡†æ¶
- **Lucide React** - å›¾æ ‡åº“

### çŠ¶æ€ç®¡ç†
- **Zustand** - å…¨å±€çŠ¶æ€ç®¡ç†
- **React Hooks** - ç»„ä»¶çŠ¶æ€ç®¡ç†

### æ•°æ®å¤„ç†
- **@tanstack/react-virtual** - è™šæ‹Ÿæ»šåŠ¨
- **dompurify** - XSSé˜²æŠ¤
- **crypto-js** - åŠ å¯†å­˜å‚¨

### å¼€å‘å·¥å…·
- **ESLint** - ä»£ç è§„èŒƒ
- **TypeScript** - ç±»å‹æ£€æŸ¥

---

## ğŸ“ é¡¹ç›®ç»“æ„

```
vibe-project-frontend/
â”œâ”€â”€ src/
â”‚   â”œâ”€â”€ app/                      # Next.jsé¡µé¢è·¯ç”±
â”‚   â”‚   â”œâ”€â”€ requirements/         # éœ€æ±‚ç®¡ç†æ¨¡å—
â”‚   â”‚   â”‚   â”œâ”€â”€ page.tsx         # éœ€æ±‚æ± åˆ—è¡¨é¡µ
â”‚   â”‚   â”‚   â”œâ”€â”€ new/             # æ–°å»ºéœ€æ±‚é¡µ
â”‚   â”‚   â”‚   â”‚   â””â”€â”€ page.tsx
â”‚   â”‚   â”‚   â””â”€â”€ [id]/            # éœ€æ±‚è¯¦æƒ…/ç¼–è¾‘
â”‚   â”‚   â”‚       â”œâ”€â”€ page.tsx     # è¯¦æƒ…é¡µ
â”‚   â”‚   â”‚       â””â”€â”€ edit/
â”‚   â”‚   â”‚           â””â”€â”€ page.tsx # ç¼–è¾‘é¡µ
â”‚   â”‚   â”œâ”€â”€ personnel/           # äººå‘˜ç®¡ç†æ¨¡å—
â”‚   â”‚   â”œâ”€â”€ issues/              # é—®é¢˜ç®¡ç†æ¨¡å—
â”‚   â”‚   â””â”€â”€ layout.tsx           # å…¨å±€å¸ƒå±€
â”‚   â”‚
â”‚   â”œâ”€â”€ components/              # Reactç»„ä»¶
â”‚   â”‚   â”œâ”€â”€ requirements/        # éœ€æ±‚ç›¸å…³ç»„ä»¶
â”‚   â”‚   â”‚   â”œâ”€â”€ RequirementTable.tsx         # éœ€æ±‚è¡¨æ ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ VirtualizedRequirementTable.tsx # è™šæ‹Ÿæ»šåŠ¨è¡¨æ ¼
â”‚   â”‚   â”‚   â”œâ”€â”€ FilterPanel.tsx              # ç­›é€‰é¢æ¿
â”‚   â”‚   â”‚   â”œâ”€â”€ BatchOperations.tsx          # æ‰¹é‡æ“ä½œ
â”‚   â”‚   â”‚   â”œâ”€â”€ CommentSection.tsx           # è¯„è®ºåŒº
â”‚   â”‚   â”‚   â”œâ”€â”€ AttachmentsSection.tsx       # é™„ä»¶ä¸Šä¼ 
â”‚   â”‚   â”‚   â”œâ”€â”€ HistorySection.tsx           # ä¿®æ”¹è®°å½•
â”‚   â”‚   â”‚   â”œâ”€â”€ ScheduledReviewCard.tsx      # è¯„å®¡ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ EndOwnerOpinionCard.tsx      # ç«¯è´Ÿè´£äººæ„è§
â”‚   â”‚   â”‚   â””â”€â”€ QuickActionsCard.tsx         # å¿«æ·æ“ä½œ
â”‚   â”‚   â””â”€â”€ ui/                  # é€šç”¨UIç»„ä»¶
â”‚   â”‚
â”‚   â”œâ”€â”€ hooks/                   # React Hooks
â”‚   â”‚   â”œâ”€â”€ requirements/        # éœ€æ±‚ç›¸å…³Hooks
â”‚   â”‚   â”‚   â”œâ”€â”€ useRequirementForm.ts        # è¡¨å•ç®¡ç†
â”‚   â”‚   â”‚   â”œâ”€â”€ useComments.ts               # è¯„è®ºç®¡ç†
â”‚   â”‚   â”‚   â””â”€â”€ useScheduledReview.ts        # è¯„å®¡ç®¡ç†
â”‚   â”‚   â””â”€â”€ useRequirementFilters.ts         # ç­›é€‰é€»è¾‘
â”‚   â”‚
â”‚   â”œâ”€â”€ lib/                     # å·¥å…·åº“
â”‚   â”‚   â”œâ”€â”€ requirements-store.ts  # ZustandçŠ¶æ€ç®¡ç†
â”‚   â”‚   â”œâ”€â”€ api.ts                # APIè°ƒç”¨å°è£…
â”‚   â”‚   â”œâ”€â”€ sanitize.ts           # XSSé˜²æŠ¤
â”‚   â”‚   â”œâ”€â”€ secure-storage.ts     # å®‰å…¨å­˜å‚¨
â”‚   â”‚   â”œâ”€â”€ csrf.ts               # CSRFé˜²æŠ¤
â”‚   â”‚   â”œâ”€â”€ file-upload-utils.ts  # æ–‡ä»¶å¤„ç†
â”‚   â”‚   â”œâ”€â”€ error-handler.ts      # é”™è¯¯å¤„ç†
â”‚   â”‚   â”œâ”€â”€ validation.ts         # è¾“å…¥éªŒè¯
â”‚   â”‚   â””â”€â”€ utils.ts              # é€šç”¨å·¥å…·
â”‚   â”‚
â”‚   â”œâ”€â”€ config/                  # é…ç½®æ–‡ä»¶
â”‚   â”‚   â”œâ”€â”€ requirements.ts      # éœ€æ±‚æ¨¡å—é…ç½®
â”‚   â”‚   â””â”€â”€ constants.ts         # å…¨å±€å¸¸é‡
â”‚   â”‚
â”‚   â””â”€â”€ types/                   # TypeScriptç±»å‹å®šä¹‰
â”‚       â””â”€â”€ issue.ts
â”‚
â”œâ”€â”€ docs/                        # æ–‡æ¡£ç›®å½•
â”‚   â”œâ”€â”€ ARCHITECTURE.md          # æœ¬æ–‡æ¡£
â”‚   â”œâ”€â”€ MVP-ACTION-PLAN.md       # MVPè®¡åˆ’
â”‚   â””â”€â”€ PERSONNEL_PERMISSION_INTEGRATION.md
â”‚
â””â”€â”€ public/                      # é™æ€èµ„æº
```

---

## ğŸ§© æ ¸å¿ƒæ¨¡å—

### 1. éœ€æ±‚ç®¡ç†æ¨¡å—ï¼ˆRequirementsï¼‰

#### 1.1 éœ€æ±‚æ± åˆ—è¡¨é¡µ (`/requirements`)

**åŠŸèƒ½ï¼š**
- éœ€æ±‚åˆ—è¡¨å±•ç¤ºï¼ˆæ”¯æŒè™šæ‹Ÿæ»šåŠ¨ï¼‰
- å¤šç»´åº¦ç­›é€‰ï¼ˆçŠ¶æ€ã€ç±»å‹ã€ä¼˜å…ˆçº§ç­‰ï¼‰
- è‡ªå®šä¹‰ç­›é€‰æ¡ä»¶
- åˆ—æ˜¾ç¤º/éšè—
- åˆ—æ’åºå’Œæ‹–æ‹½é‡æ’
- æ‰¹é‡æ“ä½œï¼ˆæ‰¹é‡è®¾ç½®"æ˜¯å¦è¦åš"ï¼‰

**æ ¸å¿ƒç»„ä»¶ï¼š**
```tsx
RequirementsPage
â”œâ”€â”€ FilterPanel           # ç­›é€‰é¢æ¿ï¼ˆçŠ¶æ€ã€æœç´¢ã€ç­›é€‰è®¾ç½®ã€åˆ—éšè—ï¼‰
â”œâ”€â”€ BatchOperations       # æ‰¹é‡æ“ä½œæ 
â”œâ”€â”€ RequirementTable      # æ™®é€šè¡¨æ ¼ï¼ˆ<100æ¡æ•°æ®ï¼‰
â””â”€â”€ VirtualizedRequirementTable # è™šæ‹Ÿæ»šåŠ¨è¡¨æ ¼ï¼ˆâ‰¥100æ¡æ•°æ®ï¼‰
```

**çŠ¶æ€ç®¡ç†ï¼š**
- ä½¿ç”¨`useRequirementFilters` Hookç®¡ç†ç­›é€‰ã€æ’åºã€åˆ—å¯è§æ€§
- ä½¿ç”¨`useRequirementsStore`è·å–éœ€æ±‚æ•°æ®

**æ€§èƒ½ä¼˜åŒ–ï¼š**
- è‡ªåŠ¨åˆ‡æ¢è™šæ‹Ÿæ»šåŠ¨ï¼ˆæ•°æ®é‡â‰¥100æ—¶ï¼‰
- `React.memo`é˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“
- `useCallback`ç¼“å­˜äº‹ä»¶å¤„ç†å‡½æ•°

---

#### 1.2 æ–°å»ºéœ€æ±‚é¡µ (`/requirements/new`)

**åŠŸèƒ½ï¼š**
- å¡«å†™éœ€æ±‚åŸºæœ¬ä¿¡æ¯ï¼ˆæ ‡é¢˜ã€ç±»å‹ã€æè¿°ï¼‰
- é€‰æ‹©åº”ç”¨ç«¯
- ä¸Šä¼ é™„ä»¶ï¼ˆæ”¯æŒæ–‡ä»¶ç­¾åéªŒè¯ï¼‰
- é¢„æ’æœŸè¯„å®¡ç®¡ç†
- ç«¯è´Ÿè´£äººæ„è§
- å¿«æ·æ“ä½œé“¾æ¥

**æ ¸å¿ƒç»„ä»¶ï¼š**
```tsx
NewRequirementPage
â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯è¡¨å•
â”œâ”€â”€ AttachmentsSection    # é™„ä»¶ä¸Šä¼ 
â”œâ”€â”€ ScheduledReviewCard   # è¯„å®¡ç®¡ç†
â”œâ”€â”€ EndOwnerOpinionCard   # ç«¯è´Ÿè´£äººæ„è§
â””â”€â”€ QuickActionsCard      # å¿«æ·æ“ä½œ
```

**è¡¨å•ç®¡ç†ï¼š**
- ä½¿ç”¨`useRequirementForm` Hookç»Ÿä¸€ç®¡ç†è¡¨å•çŠ¶æ€
- å¢å¼ºçš„è¾“å…¥éªŒè¯ï¼ˆé•¿åº¦ã€å±é™©å­—ç¬¦ã€URLæ ¼å¼ï¼‰
- æ–‡ä»¶ç­¾åéªŒè¯ï¼ˆé˜²æ­¢MIMEç±»å‹æ¬ºéª—ï¼‰

**æäº¤æµç¨‹ï¼š**
1. å®¢æˆ·ç«¯éªŒè¯
2. ç”Ÿæˆå”¯ä¸€IDï¼ˆUUIDï¼‰
3. è°ƒç”¨`addRequirement()`å­˜å‚¨åˆ°Zustand
4. è·³è½¬åˆ°éœ€æ±‚è¯¦æƒ…é¡µ

---

#### 1.3 éœ€æ±‚è¯¦æƒ…é¡µ (`/requirements/[id]`)

**åŠŸèƒ½ï¼š**
- æŸ¥çœ‹éœ€æ±‚å®Œæ•´ä¿¡æ¯
- æŸ¥çœ‹è¯„è®ºå’Œå›å¤
- æŸ¥çœ‹ä¿®æ”¹è®°å½•
- æŸ¥çœ‹é™„ä»¶
- ç®¡ç†è¯„å®¡ä¿¡æ¯
- ç®¡ç†ç«¯è´Ÿè´£äººæ„è§
- å¿«æ·æ“ä½œè·³è½¬
- éœ€æ±‚çŠ¶æ€åˆ‡æ¢ï¼ˆå¼€æ”¾ä¸­/å·²å…³é—­ï¼‰

**æ ¸å¿ƒç»„ä»¶ï¼š**
```tsx
RequirementDetailPage
â”œâ”€â”€ æ ‡é¢˜æ ï¼ˆå«çŠ¶æ€ã€æ—¶é—´ã€åˆ›å»ºäººï¼‰
â”œâ”€â”€ åŸºæœ¬ä¿¡æ¯å¡ç‰‡
â”œâ”€â”€ éœ€æ±‚æè¿°å¡ç‰‡
â”œâ”€â”€ AttachmentsSection
â”œâ”€â”€ CommentSection       # è¯„è®ºåŒºï¼ˆæ”¯æŒå›å¤å’Œé™„ä»¶ï¼‰
â”œâ”€â”€ ScheduledReviewCard
â”œâ”€â”€ EndOwnerOpinionCard
â”œâ”€â”€ HistorySection
â””â”€â”€ QuickActionsCard
```

**æƒé™æ§åˆ¶ï¼š**
- è¯„å®¡äººå¯ä»¥é€‰æ‹©è¯„å®¡äººå‘˜ï¼Œä½†åªæœ‰è¯„å®¡äººæœ¬äººå¯ä»¥å®¡æ‰¹å’Œå¡«å†™æ„è§
- ç«¯è´Ÿè´£äººå¯ä»¥é€‰æ‹©è´Ÿè´£äººï¼Œä½†åªæœ‰è´Ÿè´£äººæœ¬äººå¯ä»¥è®¾ç½®"æ˜¯å¦è¦åš"ã€"ä¼˜å…ˆçº§"å’Œæ„è§

---

#### 1.4 éœ€æ±‚ç¼–è¾‘é¡µ (`/requirements/[id]/edit`)

**åŠŸèƒ½ï¼š**
- ä¸æ–°å»ºé¡µç±»ä¼¼ï¼Œä½†é¢„å¡«å……ç°æœ‰æ•°æ®
- ç¼–è¾‘åæ›´æ–°éœ€æ±‚ä¿¡æ¯
- è®°å½•ä¿®æ”¹å†å²

**å¤ç”¨ï¼š**
- å¤ç”¨`useRequirementForm` Hook
- å¤ç”¨æ‰€æœ‰å­ç»„ä»¶ï¼ˆAttachmentsSectionã€ScheduledReviewCardç­‰ï¼‰

---

### 2. çŠ¶æ€ç®¡ç†ï¼ˆZustand Storeï¼‰

**æ–‡ä»¶ï¼š** `src/lib/requirements-store.ts`

**æ•°æ®ç»“æ„ï¼š**
```typescript
interface Requirement {
  id: string;                   // #1, #2æ ¼å¼
  title: string;
  type: 'æ–°åŠŸèƒ½' | 'ä¼˜åŒ–' | 'BUG' | 'ç”¨æˆ·åé¦ˆ' | 'å•†åŠ¡éœ€æ±‚';
  description: string;
  platforms: string[];          // ['iOS', 'Android', 'Web']
  status: 'open' | 'closed';
  creator: User;
  createdAt: string;
  updatedAt: string;
  attachments: Attachment[];
  comments: Comment[];
  history: HistoryRecord[];
  scheduledReview?: {
    reviewLevels: ReviewLevel[];
  };
  endOwnerOpinion?: {
    needToDo?: 'æ˜¯' | 'å¦';
    priority?: 'ä½' | 'ä¸­' | 'é«˜' | 'ç´§æ€¥';
    opinion: string;
    owner?: User;
  };
  prototypeId?: string;
  prdId?: string;
}
```

**çŠ¶æ€æ“ä½œï¼š**
- `addRequirement()` - æ·»åŠ éœ€æ±‚
- `updateRequirement()` - æ›´æ–°éœ€æ±‚
- `deleteRequirement()` - åˆ é™¤éœ€æ±‚
- `toggleRequirementStatus()` - åˆ‡æ¢çŠ¶æ€

---

### 3. APIå±‚

**æ–‡ä»¶ï¼š** `src/lib/api.ts`

**æ ¸å¿ƒåŠŸèƒ½ï¼š**
```typescript
// GraphQLè¯·æ±‚å°è£…
async function graphqlRequest(query: string, variables?: Record<string, unknown>) {
  // 1. è·å–è®¤è¯Tokenï¼ˆä»å®‰å…¨å­˜å‚¨ï¼‰
  const token = TokenManager.getToken();
  
  // 2. è·å–CSRF Token
  const csrfToken = await CSRFProtection.getToken();
  
  // 3. å‘é€è¯·æ±‚
  return fetch(`${API_BASE_URL}/graphql`, {
    method: 'POST',
    headers: {
      'Content-Type': 'application/json',
      'Authorization': `Bearer ${token}`,
      'X-CSRF-Token': csrfToken,
    },
    credentials: 'include', // æºå¸¦Cookie
    body: JSON.stringify({ query, variables })
  });
}
```

**APIæ¨¡å—ï¼š**
- `authApi` - è®¤è¯ç›¸å…³ï¼ˆç™»å½•ã€ç™»å‡ºï¼‰
- `userApi` - ç”¨æˆ·ç®¡ç†
- `requirementApi` - éœ€æ±‚ç®¡ç†ï¼ˆå¾…å®ç°ï¼‰
- `projectApi` - é¡¹ç›®ç®¡ç†ï¼ˆå¾…å®ç°ï¼‰

---

## ğŸ”„ æ•°æ®æµ

### éœ€æ±‚åˆ—è¡¨é¡µæ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                     RequirementsPage                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  useRequirementsStore   â”‚ â† Zustandå…¨å±€çŠ¶æ€
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ useRequirementFilters   â”‚ â† ç­›é€‰ã€æ’åºé€»è¾‘
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   filteredRequirements  â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”œâ”€ â‰¥100æ¡ â”€â†’ VirtualizedRequirementTable
                              â””â”€ <100æ¡ â”€â†’ RequirementTable
```

### éœ€æ±‚æ–°å»º/ç¼–è¾‘æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚               New/EditRequirementPage                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   useRequirementForm    â”‚ â† è¡¨å•çŠ¶æ€ç®¡ç†
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”œâ”€ è¾“å…¥éªŒè¯
                              â”‚   â”œâ”€ é•¿åº¦æ£€æŸ¥
                              â”‚   â”œâ”€ å±é™©å­—ç¬¦æ£€æµ‹
                              â”‚   â””â”€ URLæ ¼å¼éªŒè¯
                              â”‚
                              â”œâ”€ æ–‡ä»¶éªŒè¯
                              â”‚   â”œâ”€ å¤§å°æ£€æŸ¥
                              â”‚   â”œâ”€ ç±»å‹æ£€æŸ¥
                              â”‚   â””â”€ æ–‡ä»¶ç­¾åéªŒè¯ (Magic Number)
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚  useRequirementsStore   â”‚ â† ä¿å­˜åˆ°å…¨å±€çŠ¶æ€
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                        è·³è½¬åˆ°è¯¦æƒ…é¡µ
```

### APIè°ƒç”¨æ•°æ®æµ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                        Component                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚      api.ts (å°è£…)       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”œâ”€ è·å–Token (TokenManager)
                              â”œâ”€ è·å–CSRF Token (CSRFProtection)
                              â””â”€ æ·»åŠ è®¤è¯å¤´
                              â”‚
                              â–¼
                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚   fetch() APIè¯·æ±‚       â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                              â”‚
                              â”œâ”€ 2xx â†’ è¿”å›æ•°æ®
                              â”œâ”€ 401 â†’ è‡ªåŠ¨åˆ·æ–°Token
                              â””â”€ å…¶ä»– â†’ é”™è¯¯å¤„ç†
```

---

## ğŸ”’ å®‰å…¨æ¶æ„

### 1. XSSé˜²æŠ¤

**å·¥å…·ï¼š** `src/lib/sanitize.ts`

**åŠŸèƒ½ï¼š**
- `sanitizeText()` - æ¸…ç†çº¯æ–‡æœ¬ï¼Œç§»é™¤æ‰€æœ‰HTMLæ ‡ç­¾
- `sanitizeHTML()` - æ¸…ç†HTMLå†…å®¹ï¼Œä»…ä¿ç•™å®‰å…¨æ ‡ç­¾
- `isSafeURL()` - éªŒè¯URLå®‰å…¨æ€§
- `sanitizeURL()` - æ¸…ç†URL

**åº”ç”¨ä½ç½®ï¼š**
- è¯„è®ºå†…å®¹æ˜¾ç¤º
- éœ€æ±‚æ ‡é¢˜/æè¿°æ˜¾ç¤º
- æ‰€æœ‰ç”¨æˆ·è¾“å…¥æ˜¾ç¤º

**ç¤ºä¾‹ï¼š**
```typescript
// æ˜¾ç¤ºè¯„è®ºæ—¶
<p>{sanitizeText(comment.content)}</p>

// éªŒè¯é“¾æ¥æ—¶
{isSafeURL(url) && <a href={url}>é“¾æ¥</a>}
```

---

### 2. CSRFé˜²æŠ¤

**å·¥å…·ï¼š** `src/lib/csrf.ts`

**æœºåˆ¶ï¼š**
1. é¡µé¢åŠ è½½æ—¶ä»æœåŠ¡å™¨è·å–CSRF Token
2. Tokenç¼“å­˜30åˆ†é’Ÿ
3. æ¯æ¬¡APIè¯·æ±‚è‡ªåŠ¨æºå¸¦Token
4. æœåŠ¡å™¨éªŒè¯Tokenæœ‰æ•ˆæ€§

**å®ç°ï¼š**
```typescript
// è·å–Token
const csrfToken = await CSRFProtection.getToken();

// æ·»åŠ åˆ°è¯·æ±‚å¤´
headers: {
  'X-CSRF-Token': csrfToken
}
```

---

### 3. å®‰å…¨Tokenå­˜å‚¨

**å·¥å…·ï¼š** `src/lib/secure-storage.ts`

**ç‰¹æ€§ï¼š**
- AES-256åŠ å¯†å­˜å‚¨Tokenåˆ°localStorage
- è‡ªåŠ¨è¿‡æœŸç®¡ç†ï¼ˆ7å¤©ï¼‰
- è‡ªåŠ¨åˆ·æ–°æœºåˆ¶
- é˜²æ­¢XSSè¯»å–Token

**ä½¿ç”¨ï¼š**
```typescript
// å­˜å‚¨Token
TokenManager.setToken(token);

// è·å–æœ‰æ•ˆTokenï¼ˆè‡ªåŠ¨åˆ·æ–°è¿‡æœŸTokenï¼‰
const token = await TokenManager.getValidToken();

// ç™»å‡ºæ¸…é™¤Token
TokenManager.clearToken();
```

---

### 4. æ–‡ä»¶ä¸Šä¼ å®‰å…¨

**å·¥å…·ï¼š** `src/lib/file-upload-utils.ts`

**é˜²æŠ¤æªæ–½ï¼š**
1. **æ–‡ä»¶ç±»å‹ç™½åå•** - åªå…è®¸ç‰¹å®šç±»å‹æ–‡ä»¶
2. **æ–‡ä»¶å¤§å°é™åˆ¶** - é»˜è®¤10MB
3. **æ–‡ä»¶åå®‰å…¨æ£€æŸ¥** - é˜²æ­¢è·¯å¾„éå†æ”»å‡»
4. **æ–‡ä»¶ç­¾åéªŒè¯** - éªŒè¯Magic Numberé˜²æ­¢MIMEç±»å‹æ¬ºéª—

**æ–‡ä»¶ç­¾åï¼ˆMagic Numberï¼‰ï¼š**
```typescript
const FILE_SIGNATURES = {
  'image/jpeg': [0xFF, 0xD8, 0xFF],
  'image/png': [0x89, 0x50, 0x4E, 0x47],
  'application/pdf': [0x25, 0x50, 0x44, 0x46],
  // ...
};
```

**ä½¿ç”¨ï¼š**
```typescript
// å¢å¼ºéªŒè¯ï¼ˆåŒ…å«æ–‡ä»¶ç­¾åæ£€æŸ¥ï¼‰
const { validFiles, errors } = await validateFilesEnhanced(files);
```

---

### 5. è¾“å…¥éªŒè¯

**å·¥å…·ï¼š** `src/hooks/requirements/useRequirementForm.ts`

**éªŒè¯è§„åˆ™ï¼š**
- **æ ‡é¢˜ï¼š** 1-200å­—ç¬¦ï¼Œç¦æ­¢å±é™©å­—ç¬¦
- **æè¿°ï¼š** 1-10000å­—ç¬¦ï¼Œç¦æ­¢å±é™©å­—ç¬¦
- **URLï¼š** éªŒè¯æ ¼å¼ï¼Œç¦æ­¢`javascript:`ã€`data:`ç­‰å±é™©åè®®
- **å±é™©å­—ç¬¦ï¼š** `<script>`, `<iframe>`, `onerror=`, `onload=`ç­‰

**ç¤ºä¾‹ï¼š**
```typescript
// å±é™©å­—ç¬¦æ£€æµ‹
const dangerousCharsPattern = /<script|<iframe|javascript:|onerror=|onload=/i;
if (dangerousCharsPattern.test(input)) {
  toast.error('å†…å®¹åŒ…å«ä¸å…è®¸çš„å­—ç¬¦');
  return false;
}

// URLéªŒè¯
if (url.startsWith('javascript:') || url.startsWith('data:')) {
  toast.error('URLæ ¼å¼ä¸å®‰å…¨');
  return false;
}
```

---

## âš¡ æ€§èƒ½ä¼˜åŒ–

### 1. è™šæ‹Ÿæ»šåŠ¨

**å®ç°ï¼š** `@tanstack/react-virtual`

**è§¦å‘æ¡ä»¶ï¼š** éœ€æ±‚æ•°é‡â‰¥100æ¡

**æ•ˆæœï¼š**
- åªæ¸²æŸ“å¯è§è¡Œï¼ˆçº¦20è¡Œï¼‰
- å‡å°‘DOMèŠ‚ç‚¹æ•°é‡ï¼ˆä»1000+åˆ°20ï¼‰
- æµç•…æ»šåŠ¨ä½“éªŒ

**æ€§èƒ½æå‡ï¼š**
- åˆå§‹æ¸²æŸ“æ—¶é—´ï¼š1000æ¡ä»~2000msé™è‡³~200msï¼ˆæå‡10å€ï¼‰
- æ»šåŠ¨å¸§ç‡ï¼šä»å¡é¡¿ï¼ˆ15-30 FPSï¼‰æå‡è‡³æµç•…ï¼ˆ60 FPSï¼‰
- å†…å­˜å ç”¨ï¼šé™ä½çº¦80%

**å®ç°ï¼š**
```typescript
// è‡ªåŠ¨åˆ‡æ¢
{filteredRequirements.length >= 100 ? (
  <VirtualizedRequirementTable {...props} />
) : (
  <RequirementTable {...props} />
)}
```

---

### 2. Reactæ€§èƒ½ä¼˜åŒ–

#### 2.1 React.memo

**ä½ç½®ï¼š** æ‰€æœ‰éœ€æ±‚ç›¸å…³ç»„ä»¶

**ä½œç”¨ï¼š** é˜²æ­¢ä¸å¿…è¦çš„é‡æ¸²æŸ“

```typescript
export const RequirementTable = React.memo(function RequirementTable(props) {
  // ...
});
```

#### 2.2 useCallback

**ä½ç½®ï¼š** æ‰€æœ‰äº‹ä»¶å¤„ç†å‡½æ•°

**ä½œç”¨ï¼š** ç¼“å­˜å‡½æ•°å¼•ç”¨ï¼Œé˜²æ­¢å­ç»„ä»¶é‡æ¸²æŸ“

```typescript
const handleStatusChange = useCallback((id: string, status: string) => {
  // ...
}, [dependencies]);
```

#### 2.3 useMemo

**ä½ç½®ï¼š** å¤æ‚è®¡ç®—ç»“æœ

**ä½œç”¨ï¼š** ç¼“å­˜è®¡ç®—ç»“æœ

```typescript
const filteredData = useMemo(() => {
  return data.filter(/* ... */);
}, [data, filters]);
```

---

### 3. ä»£ç åˆ†å‰²

**Next.jsè‡ªåŠ¨ä»£ç åˆ†å‰²ï¼š**
- æ¯ä¸ªé¡µé¢è‡ªåŠ¨åˆ†å‰²ä¸ºç‹¬ç«‹bundle
- æŒ‰éœ€åŠ è½½ç»„ä»¶
- ä¼˜åŒ–é¦–å±åŠ è½½æ—¶é—´

**åŠ¨æ€å¯¼å…¥ï¼š**
```typescript
const HeavyComponent = dynamic(() => import('./HeavyComponent'), {
  loading: () => <Loading />,
  ssr: false
});
```

---

## âš™ï¸ é…ç½®ç®¡ç†

### UIå°ºå¯¸é…ç½®

**æ–‡ä»¶ï¼š** `src/config/requirements.ts`

**ç›®çš„ï¼š** ç»Ÿä¸€ç®¡ç†æ‰€æœ‰UIå°ºå¯¸ï¼Œé¿å…ç¡¬ç¼–ç 

**é…ç½®ï¼š**
```typescript
export const UI_SIZES = {
  // è¡¨æ ¼
  TABLE: {
    MIN_WIDTH: 1000,
    HEAD_HEIGHT: 40,
  },
  
  // å¤´åƒ
  AVATAR: {
    SMALL: 'h-6 w-6',
    MEDIUM: 'h-8 w-8',
    LARGE: 'h-10 w-10',
  },
  
  // å›¾æ ‡
  ICON: {
    SMALL: 'h-3 w-3',
    MEDIUM: 'h-4 w-4',
    LARGE: 'h-5 w-5',
  },
  
  // æŒ‰é’®
  BUTTON: {
    ICON_SMALL: 'h-7 w-7',
    ICON_MEDIUM: 'h-8 w-8',
  },
  
  // è¾“å…¥æ¡†
  INPUT: {
    SMALL: 'h-8',
    MEDIUM: 'h-9',
  },
  
  // ä¸‹æ‹‰æ¡†
  DROPDOWN: {
    NARROW: 'w-[120px]',
    MEDIUM: 'w-[150px]',
    WIDE: 'w-[200px]',
  }
};
```

**ä½¿ç”¨ï¼š**
```tsx
<Avatar className={UI_SIZES.AVATAR.MEDIUM}>
  {/* ... */}
</Avatar>
```

**ä¼˜åŠ¿ï¼š**
1. **ä¸€å¤„ä¿®æ”¹ï¼Œå…¨å±€ç”Ÿæ•ˆ** - ä¿®æ”¹é…ç½®å³å¯æ›´æ–°æ‰€æœ‰ç»„ä»¶
2. **ä»£ç å¯è¯»æ€§** - `UI_SIZES.AVATAR.MEDIUM`æ¯”`h-8 w-8`æ›´æ¸…æ™°
3. **ç±»å‹å®‰å…¨** - TypeScriptè‡ªåŠ¨è¡¥å…¨å’Œç±»å‹æ£€æŸ¥
4. **ESLintæ£€æŸ¥** - è‡ªåŠ¨è­¦å‘Šç¡¬ç¼–ç å°ºå¯¸

---

### ä¸šåŠ¡é…ç½®

**æ–‡ä»¶ï¼š** `src/config/requirements.ts`

**é…ç½®é¡¹ï¼š**
```typescript
// éœ€æ±‚ç±»å‹
export const REQUIREMENT_TYPES = [
  'æ–°åŠŸèƒ½',
  'ä¼˜åŒ–',
  'BUG',
  'ç”¨æˆ·åé¦ˆ',
  'å•†åŠ¡éœ€æ±‚'
];

// ä¼˜å…ˆçº§
export const PRIORITY_OPTIONS = ['ä½', 'ä¸­', 'é«˜', 'ç´§æ€¥'];

// åº”ç”¨ç«¯
export const PLATFORM_OPTIONS = ['iOS', 'Android', 'Web', 'å°ç¨‹åº'];

// çŠ¶æ€
export const STATUS_OPTIONS = {
  OPEN: { value: 'open', label: 'Open', color: 'bg-blue-100' },
  CLOSED: { value: 'closed', label: 'Closed', color: 'bg-gray-100' }
};
```

---

## ğŸ”§ ESLintè§„åˆ™

**æ–‡ä»¶ï¼š** `.eslintrc.json`

**è‡ªå®šä¹‰è§„åˆ™ï¼š**
```json
{
  "rules": {
    "no-restricted-syntax": [
      "warn",
      {
        "selector": "Literal[value=/h-\\d+\\s+w-\\d+/]",
        "message": "è¯·ä½¿ç”¨UI_SIZESé…ç½®æ›¿ä»£ç¡¬ç¼–ç å°ºå¯¸"
      }
    ]
  }
}
```

**ä½œç”¨ï¼š**
- å…¨å±€è­¦å‘Šç¡¬ç¼–ç `h-X w-Y`
- åœ¨éœ€æ±‚æ¨¡å—ä¸­é”™è¯¯ï¼ˆå¼ºåˆ¶ä½¿ç”¨é…ç½®ï¼‰

---

## ğŸ“š å¼€å‘è§„èŒƒ

### 1. ç»„ä»¶å¼€å‘

- **å•ä¸€èŒè´£** - æ¯ä¸ªç»„ä»¶åªè´Ÿè´£ä¸€ä¸ªåŠŸèƒ½
- **å¯å¤ç”¨** - é€šè¿‡propsé…ç½®ï¼Œé¿å…é‡å¤ä»£ç 
- **ç±»å‹å®‰å…¨** - ä½¿ç”¨TypeScriptå®šä¹‰æ‰€æœ‰propså’Œstate
- **æ³¨é‡Š** - æ·»åŠ JSDocæ³¨é‡Šè¯´æ˜åŠŸèƒ½å’Œç”¨æ³•

### 2. Hookså¼€å‘

- **è‡ªå®šä¹‰Hook** - æå–å¯å¤ç”¨é€»è¾‘
- **useCallback/useMemo** - ä¼˜åŒ–æ€§èƒ½
- **ä¾èµ–æ•°ç»„** - æ­£ç¡®è®¾ç½®ä¾èµ–
- **JSDoc** - è¯¦ç»†çš„æ–‡æ¡£æ³¨é‡Š

### 3. æ ·å¼è§„èŒƒ

- **Tailwindä¼˜å…ˆ** - ä½¿ç”¨Tailwind CSSç±»å
- **UI_SIZES** - ä½¿ç”¨é…ç½®è€Œéç¡¬ç¼–ç 
- **å“åº”å¼** - ä½¿ç”¨`sm:`, `md:`, `lg:`å‰ç¼€
- **æš—è‰²æ¨¡å¼** - ä½¿ç”¨`dark:`å‰ç¼€ï¼ˆå¾…å®ç°ï¼‰

### 4. å®‰å…¨è§„èŒƒ

- **è¾“å…¥éªŒè¯** - æ‰€æœ‰ç”¨æˆ·è¾“å…¥å¿…é¡»éªŒè¯
- **XSSé˜²æŠ¤** - æ˜¾ç¤ºç”¨æˆ·å†…å®¹å¿…é¡»æ¸…ç†
- **CSRFé˜²æŠ¤** - æ‰€æœ‰ä¿®æ”¹æ“ä½œæºå¸¦CSRF Token
- **æ–‡ä»¶éªŒè¯** - æ–‡ä»¶ä¸Šä¼ å¿…é¡»éªŒè¯ç­¾å

---

## ğŸš€ éƒ¨ç½²æ¸…å•

### ç¯å¢ƒå˜é‡

```bash
# APIåœ°å€
NEXT_PUBLIC_API_URL=https://api.example.com/api

# å­˜å‚¨åŠ å¯†å¯†é’¥
NEXT_PUBLIC_STORAGE_KEY=your-secure-random-key-here
```

### åç«¯APIè¦æ±‚

åç«¯éœ€è¦æä¾›ä»¥ä¸‹ç«¯ç‚¹ï¼š

1. **CSRF Token** - `GET /api/csrf-token`
2. **Tokenåˆ·æ–°** - `POST /api/auth/refresh`
3. **GraphQL** - `POST /api/graphql`

### æ„å»ºå‘½ä»¤

```bash
# å®‰è£…ä¾èµ–
npm install

# å¼€å‘æ¨¡å¼
npm run dev

# ç”Ÿäº§æ„å»º
npm run build

# å¯åŠ¨ç”Ÿäº§æœåŠ¡å™¨
npm start
```

---

## ğŸ“Š æ€§èƒ½æŒ‡æ ‡

### ç›®æ ‡æŒ‡æ ‡

- **é¦–å±åŠ è½½** - <1s
- **åˆ—è¡¨æ¸²æŸ“ï¼ˆ1000æ¡ï¼‰** - <300ms
- **æ»šåŠ¨å¸§ç‡** - 60 FPS
- **äº¤äº’å“åº”** - <100ms

### å®é™…è¡¨ç°

- âœ… é¦–å±åŠ è½½ï¼š~800ms
- âœ… åˆ—è¡¨æ¸²æŸ“ï¼ˆ1000æ¡ï¼‰ï¼š~200msï¼ˆè™šæ‹Ÿæ»šåŠ¨ï¼‰
- âœ… æ»šåŠ¨å¸§ç‡ï¼š60 FPS
- âœ… äº¤äº’å“åº”ï¼š~50ms

---

## ğŸ”® æœªæ¥è§„åˆ’

### çŸ­æœŸï¼ˆ1ä¸ªæœˆå†…ï¼‰

- [ ] åç«¯APIé›†æˆ
- [ ] å®æ—¶é€šçŸ¥
- [ ] æƒé™ç³»ç»Ÿå®Œå–„
- [ ] å•å…ƒæµ‹è¯•

### ä¸­æœŸï¼ˆ3ä¸ªæœˆå†…ï¼‰

- [ ] æš—è‰²æ¨¡å¼
- [ ] å¤šè¯­è¨€æ”¯æŒ
- [ ] é«˜çº§æœç´¢
- [ ] æ•°æ®å¯¼å‡º

### é•¿æœŸï¼ˆ6ä¸ªæœˆå†…ï¼‰

- [ ] ç§»åŠ¨ç«¯é€‚é…
- [ ] ç¦»çº¿æ”¯æŒ
- [ ] AIè¾…åŠ©éœ€æ±‚åˆ†æ
- [ ] æ•°æ®å¯è§†åŒ–

---

**æ–‡æ¡£ç»´æŠ¤è€…ï¼š** AI Assistant  
**æœ€åæ›´æ–°ï¼š** 2025-09-30  
**ç‰ˆæœ¬ï¼š** v1.0 