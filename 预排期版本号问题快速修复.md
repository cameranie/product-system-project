# 预排期版本号选择不生效 - 快速修复指南

## ❌ 问题
预排期页面列表，关联版本号管理数据后，选择、修改版本号不生效

## ✅ 答案
**不是模拟数据的问题！** 是因为版本管理系统中还没有版本数据。

## 🔧 原因
预排期页面的版本号来自**版本管理页面** (`/versions`)，数据存储在浏览器的 localStorage 中。

如果版本管理页面没有添加版本记录，下拉列表只会显示"暂无版本号"。

## 🚀 快速解决（3步）

### 方法一：使用脚本自动添加测试数据（最快）

1. **打开浏览器开发者工具**（按 F12）

2. **在控制台粘贴以下代码并回车**：

```javascript
// 一键添加测试版本数据
const testVersions = [
  {
    id: 'ios-1.0.0-' + Date.now(),
    platform: 'iOS',
    versionNumber: '1.0.0',
    releaseDate: '2025-11-01',
    schedule: {
      prdStartDate: '2025-10-07',
      prdEndDate: '2025-10-09',
      prototypeStartDate: '2025-10-14',
      prototypeEndDate: '2025-10-18',
      devStartDate: '2025-10-21',
      devEndDate: '2025-10-25',
      testStartDate: '2025-10-28',
      testEndDate: '2025-11-01'
    },
    createdAt: new Date().toLocaleString('zh-CN'),
    updatedAt: new Date().toLocaleString('zh-CN')
  },
  {
    id: 'android-2.0.0-' + Date.now(),
    platform: '安卓',
    versionNumber: '2.0.0',
    releaseDate: '2025-11-15',
    schedule: {
      prdStartDate: '2025-10-21',
      prdEndDate: '2025-10-23',
      prototypeStartDate: '2025-10-28',
      prototypeEndDate: '2025-11-01',
      devStartDate: '2025-11-04',
      devEndDate: '2025-11-08',
      testStartDate: '2025-11-11',
      testEndDate: '2025-11-15'
    },
    createdAt: new Date().toLocaleString('zh-CN'),
    updatedAt: new Date().toLocaleString('zh-CN')
  },
  {
    id: 'pc-1.5.0-' + Date.now(),
    platform: 'PC',
    versionNumber: '1.5.0',
    releaseDate: '2025-12-01',
    schedule: {
      prdStartDate: '2025-11-04',
      prdEndDate: '2025-11-06',
      prototypeStartDate: '2025-11-11',
      prototypeEndDate: '2025-11-15',
      devStartDate: '2025-11-18',
      devEndDate: '2025-11-22',
      testStartDate: '2025-11-25',
      testEndDate: '2025-12-01'
    },
    createdAt: new Date().toLocaleString('zh-CN'),
    updatedAt: new Date().toLocaleString('zh-CN')
  }
];

localStorage.setItem('version_management_versions', JSON.stringify(testVersions));
console.log('✅ 已添加 ' + testVersions.length + ' 个测试版本！');
console.log('版本列表：');
testVersions.forEach(v => console.log('  - ' + v.platform + ' ' + v.versionNumber));
console.log('\n请刷新页面查看效果！');
```

3. **刷新页面**（按 F5），现在版本号下拉列表应该有数据了！

### 方法二：通过版本管理页面手动添加

1. 访问版本管理页面：`/versions`
2. 点击"新建版本"
3. 填写信息：
   - 应用端：iOS / 安卓 / PC / web
   - 版本号：1.0.0（格式：x.y.z）
   - 上线时间：选择日期
4. 保存
5. 返回预排期页面并刷新

## 📋 验证是否成功

1. **检查版本数据**（在控制台输入）：
```javascript
const versions = JSON.parse(localStorage.getItem('version_management_versions') || '[]');
console.log('版本数量:', versions.length);
console.log('版本列表:', versions.map(v => v.platform + ' ' + v.versionNumber));
```

2. **测试版本号选择**：
   - 进入预排期页面 `/scheduled`
   - 点击任意需求的版本号
   - 应该能看到版本号列表（如：iOS 1.0.0、安卓 2.0.0）
   - 选择一个版本
   - 看到"版本号已更新"提示
   - 刷新页面，版本号应该保存成功

## 🐛 还是不行？

### 检查1：版本数据是否存在
```javascript
console.log(localStorage.getItem('version_management_versions'));
// 应该返回一个 JSON 数组，不是 null
```

### 检查2：清除缓存重试
```javascript
// 清除版本数据
localStorage.removeItem('version_management_versions');
// 然后重新执行"方法一"的代码
```

### 检查3：查看控制台错误
- 按 F12 打开开发者工具
- 切换到 Console 标签
- 看是否有红色错误信息

## 📊 技术说明

**版本号显示格式：** `{平台} {版本号}`

例如：
- iOS 1.0.0
- 安卓 2.0.0
- PC 1.5.0

**数据流程：**
```
版本管理页面 → localStorage → 预排期页面版本下拉列表
```

**存储位置：**
- localStorage 键名：`version_management_versions`
- 需求版本号字段：`requirement.plannedVersion`

## 📝 更多信息

详细文档：`docs/VERSION_SELECTION_FIX.md`

